import{c as E,r as p,s as y,j as h}from"./index-BHO2iGLr.js";function v(){const e=E.c(13);let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n=[],e[0]=n):n=e[0];const[t,l]=p.useState(n),m=p.useRef(0);let u,i;e[1]===Symbol.for("react.memo_cache_sentinel")?(u=()=>{const f=y.channel("emoji_reactions").on("postgres_changes",{event:"INSERT",schema:"public",table:"emoji_reactions"},x=>{const g=x.new?.id,b=x.new?.emoji,_=Math.random()*70+10;l(j=>(m.current=m.current+1,[...j,{id:String(m.current),emoji:b,left:_}])),g&&(async()=>{try{await y.from("emoji_reactions").delete().eq("id",g)}catch(j){console.error("Failed to delete emoji_reaction row",j)}})()}).subscribe();return()=>{y.removeChannel(f)}},i=[],e[1]=u,e[2]=i):(u=e[1],i=e[2]),p.useEffect(u,i);let r;e[3]!==t.length?(r=()=>{if(t.length===0)return;const f=setTimeout(()=>{l(S)},1200);return()=>clearTimeout(f)},e[3]=t.length,e[4]=r):r=e[4];let c;e[5]!==t?(c=[t],e[5]=t,e[6]=c):c=e[6],p.useEffect(r,c);let a;e[7]===Symbol.for("react.memo_cache_sentinel")?(a={position:"fixed",left:0,bottom:0,width:"100%",pointerEvents:"none",zIndex:50},e[7]=a):a=e[7];let s;e[8]!==t?(s=t.map(I),e[8]=t,e[9]=s):s=e[9];let o;e[10]===Symbol.for("react.memo_cache_sentinel")?(o=h.jsx("style",{children:`
        @keyframes floatUp {
          0% { transform: translateY(0) scale(1); opacity: 0.8; }
          60% { transform: translateY(-60px) scale(1.5); opacity: 1; }
          100% { transform: translateY(-120px) scale(2); opacity: 0; }
        }
      `}),e[10]=o):o=e[10];let d;return e[11]!==s?(d=h.jsxs("div",{style:a,children:[s,o]}),e[11]=s,e[12]=d):d=e[12],d}function I(e){return h.jsx("span",{style:{position:"absolute",left:`${e.left}%`,bottom:0,fontSize:"2rem",opacity:0,animation:"floatUp 1.2s cubic-bezier(.4,0,.2,1) forwards"},children:e.emoji},e.id)}function S(e){return e.slice(1)}function R(e){const n=e?.quant,t=e?.roomId,l=e?.limit,[m,u]=p.useState([]);return p.useEffect(()=>{let i,r=!0;async function c(){try{let a=y.from("drawings").select("id,user_id,created_at,data").order("created_at",{ascending:!1}).limit(l);t&&(a=a.eq("room_id",t));const{data:s,error:o}=await a;if(o){console.error("Error fetching initial drawings:",o.message);return}if(!r)return;const d=(s||[]).map(f=>{const x=[];try{const b=f.data?.p||[];for(const _ of b)x.push({x:_[0]/n,y:_[1]/n})}catch{}return{id:f.id,user_id:f.user_id??null,created_at:f.created_at,path:x}});u(d.reverse())}catch(a){console.error("Unexpected error fetching drawings:",a)}}return c(),i=y.channel("realtime-drawings").on("postgres_changes",{event:"INSERT",schema:"public",table:"drawings"},a=>{try{const s=a.new,d=(s.data?.p||[]).map(f=>({x:f[0]/n,y:f[1]/n}));u(f=>[...f,{id:s.id,user_id:s.user_id??null,created_at:s.created_at,path:d}])}catch(s){console.error("Error parsing incoming drawing",s)}}).on("postgres_changes",{event:"DELETE",schema:"public",table:"drawings"},a=>{const s=a.old?.id;s&&u(o=>o.filter(d=>d.id!==s))}).subscribe(),()=>{r=!1,i&&y.removeChannel(i)}},[n,t,l]),{drawings:m}}function w(e,n){let t=2166136261;for(let l=0;l<e.length;l++)t=Math.imul(t^e.charCodeAt(l),16777619)>>>0;return t%n}function $(){const e=[];for(let n=1;n<=5;n++){const t=getComputedStyle(document.documentElement).getPropertyValue(`--chart-${n}`);t&&e.push(t.trim())}return e.length===0&&e.push("#1B2FDB"),e}function T(){const{drawings:e}=R({quant:100,limit:50}),n=$(),t=p.useRef([]),l=p.useRef({}),[,m]=p.useState(0);p.useEffect(()=>{e.forEach(r=>{if(l.current[r.id])return;const c=w(r.id+"side",3),a=["left","right","bottom"][c],s=w(r.id+"off",100)/100,o=a==="bottom"?s*60+10:s*70+5,d=w(r.id+"col",n.length),f=n[d],x={id:r.id,path:r.path,placement:{side:a,offset:o},color:f};t.current.push(x),l.current[r.id]=!0,m(g=>g+1)});const i=new Set(e.map(r=>r.id));for(let r=t.current.length-1;r>=0;r--){const c=t.current[r].id;i.has(c)||(t.current.splice(r,1),delete l.current[c],m(a=>a+1))}},[e,n]);const u=t.current;return h.jsx("div",{className:"pointer-events-none fixed inset-0 z-50",children:u.map(i=>{let c={position:"absolute",width:160,height:160};return i.placement.side==="left"?(c.left=12,c.top=`${i.placement.offset}%`):i.placement.side==="right"?(c.right=12,c.top=`${i.placement.offset}%`):(c.left=`${i.placement.offset}%`,c.bottom=12),h.jsx("div",{style:c,className:"opacity-95 fade-out transition-opacity",children:h.jsx("svg",{viewBox:"0 0 100 100",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid meet",children:h.jsx("g",{transform:"translate(6,6) scale(0.88)",children:h.jsx("path",{d:z(i.path),fill:"none",stroke:i.color,strokeWidth:8,strokeLinecap:"round",strokeLinejoin:"round",opacity:.95})})})},i.id)})})}function z(e){if(!e||e.length===0)return"";let n=1/0,t=1/0,l=-1/0,m=-1/0;for(const o of e)o.x<n&&(n=o.x),o.y<t&&(t=o.y),o.x>l&&(l=o.x),o.y>m&&(m=o.y);const u=l-n||1,i=m-t||1,r=88,c=6,a=6,s=[];return e.forEach((o,d)=>{const f=(o.x-n)/u*r+c,x=(o.y-t)/i*r+a;s.push(`${d===0?"M":"L"} ${f.toFixed(2)} ${x.toFixed(2)}`)}),s.join(" ")}function C(){const e=E.c(1);let n;return e[0]===Symbol.for("react.memo_cache_sentinel")?(n=h.jsxs("div",{className:"p-2",children:[h.jsx("h3",{children:"Welcome Home!"}),h.jsx(T,{}),h.jsx(v,{})]}),e[0]=n):n=e[0],n}export{C as component};
